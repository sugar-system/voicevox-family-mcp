# Usage Scenarios

**Last Updated:** 2025/05/26
**Status:** 開発中

## Primary Usage Scenario

### 基本的な音声合成フロー

1. **TTSサーバー準備**

   - ユーザーは使用したいTTSサーバのみを立ち上げておく（複数同時でもOK）
   - 設定ファイルには複数のサーバー情報が含まれているが、全て起動している必要はない

2. **話者リスト取得**

   - ユーザー指示によりAIは`list_speakers`ツールを使用
   - MCPサーバは起動パラメータに含まれたTTSサーバすべてに話者リストをリクエスト
   - 応答があったサーバーの話者情報をまとめてAIに返答

3. **音声合成実行**
   - AIは話者リストからサーバーIDと話者IDを取得
   - テキストと合わせて`speak_response`ツールを使用
   - MCPサーバが指定されたTTSサーバに音声合成をリクエスト
   - 得られた音声を再生

## Server Management Philosophy

### 動的発見方式の採用

- **基本方針**: 設定ファイルに含まれるサーバーに対して、list_speakersツール呼び出しをもって生存確認とする
- **応答ベース利用**: 応答があったサーバーのみを利用対象とする
- **最小限エラーログ**: 応答しないサーバーは簡単なログ出力のみ（1行、スタックトレースなし）
- **継続監視なし**: サーバーの状態を継続的に監視・管理しない

### 利点

- **シンプルな運用**: ユーザーは使いたいサーバーだけ起動すればよい
- **柔軟性**: サーバーの起動・停止を自由に行える
- **軽量**: 継続的な監視処理が不要
- **実用性**: 実際の使用パターンに合致

## Requirements Derived from Flow

### TTSサーバー管理要件

1. **設定ファイル管理**

   - 複数のTTSサーバー情報（URL、ポート等）を設定ファイルで管理
   - サーバーの有効/無効状態は起動状態で判断（設定での制御は不要）

2. **動的サーバー発見**

   - `list_speakers`呼び出し時に設定されたサーバーへの接続を試行
   - 応答タイムアウトは適切に設定（例：3秒程度）
   - 接続失敗時は簡潔なログ出力のみ

3. **エラーハンドリング**
   - ネットワークエラー: 「Server [URL] is not responding」程度の簡潔なログ
   - 全サーバー応答なし: 適切なエラーメッセージをAIに返答
   - 部分的な応答: 応答があったサーバーの情報のみ返答

### 話者リスト統合要件

1. **統一フォーマット**

   - サーバーID + 話者IDの組み合わせで一意識別
   - 話者名の重複時はサーバー名を併記
   - 各エンジン固有の情報（スタイル等）も含める

2. **レスポンス形式**
   - AIが理解しやすい構造化された形式
   - サーバー別の話者情報を明確に区別
   - 利用可能なサーバー一覧も含める

## Future Scenarios

### 拡張シナリオ

1. **バッチ音声合成**

   - 複数のテキストを一括で音声合成
   - 異なる話者での連続音声生成

2. **音声パラメータ調整**

   - 速度、音程、音量等の詳細調整
   - プリセット設定の保存・呼び出し

3. **coeiroink v2対応**
   - 拡張AudioQueryへの対応
   - 新しいエンドポイントの活用

### 運用シナリオ

1. **開発環境**

   - ローカルでの複数サーバー起動
   - 開発中のサーバーとの連携テスト

2. **本番環境**
   - 安定したサーバーのみ起動
   - 高可用性を考慮した冗長構成

## Edge Cases & Error Scenarios

### 一般的なエラーケース

1. **全サーバー応答なし**

   - 適切なエラーメッセージでAIに通知
   - 設定確認やサーバー起動を促すメッセージ

2. **音声合成中のサーバー停止**

   - 音声合成リクエスト時のエラーハンドリング
   - 他の利用可能なサーバーでの代替実行は行わない（明示的な選択を尊重）

3. **不正なパラメータ**
   - サーバーID・話者IDの組み合わせが無効
   - テキストが空または不正

### 特殊ケース

1. **サーバー設定変更**

   - 設定ファイル変更後の動的反映
   - 新しいサーバーの自動発見

2. **ネットワーク問題**
   - 一時的な接続問題への対応
   - タイムアウト設定の調整

---

_このファイルは使用シナリオや要件が変更された際に更新してください。_
